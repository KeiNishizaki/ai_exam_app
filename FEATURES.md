# AI問題集メーカー - 機能仕様書

## 🎯 プロジェクト概要

このアプリケーションは、AI（Azure OpenAI）を使用して自動的に試験問題を生成し、インタラクティブに学習できるWebアプリケーションです。

## 📁 ディレクトリ構造

```
src/app/
├── page.tsx                    # ホーム画面（メニュー）
├── generate/
│   └── page.tsx               # 問題生成ページ
├── exam/
│   ├── [id]/
│   │   └── page.tsx           # 個別問題表示ページ
│   └── results/
│       └── page.tsx           # 試験結果ページ
├── bookmarks/
│   └── page.tsx               # ブックマーク一覧ページ
├── api/
│   ├── generate/
│   │   └── route.ts           # 問題生成API
│   └── bookmarks/
│       └── route.ts           # (オプション)ブックマーク管理API
└── globals.css                # グローバルスタイル

src/hooks/
└── useBookmarks.ts            # ブックマーク管理カスタムフック
```

## 📄 各ページの説明

### 1. ホーム画面 (`page.tsx`)
**役割**: アプリケーションのメインメニュー

**機能**:
- 新規問題生成ページへのリンク
- ブックマーク済み問題ページへのリンク
- ブックマーク数の表示
- アプリの特徴説明

**状態管理**:
- `bookmarkCount`: ブックマーク数

---

### 2. 問題生成ページ (`/generate/page.tsx`)
**役割**: AIが問題を生成するための設定ページ

**機能**:
- ✅ 試験名の入力（必須）
- ✅ 学習資料の入力方式選択
  - URLから取得
  - テキストを直接入力
- ✅ 出題数の選択（1～10問）
- ✅ 難易度の選択
  - 初心者向け
  - 試験相応
  - 専門家向け
- ✅ 戻るボタン・ホームボタン
- ✅ 問題生成実行

**フロー**:
1. 設定を入力
2. 「問題を生成して開始」をクリック
3. `/api/generate` にPOSTリクエスト
4. 生成された問題を `sessionStorage` に保存
5. `/exam/0` にリダイレクト（最初の問題へ）

---

### 3. 個別問題表示ページ (`/exam/[id]/page.tsx`)
**役割**: 1問ずつ問題を表示し、回答できるページ

**機能**:
- ✅ 現在の問題番号と総問題数を表示
- ✅ 進捗バー表示
- ✅ 問題文表示
- ✅ 4択の選択肢表示
- ✅ 回答時に正解/不正解判定
- ✅ 紙吹雪エフェクト（正解時）
- ✅ 詳細な解説表示
- ✅ **ブックマークボタン** （要望③④に対応）
- ✅ **戻るボタン**（要望②に対応）
- ✅ **ホームボタン**（要望②に対応）
- ✅ 前後の問題への移動ボタン

**状態管理**:
- `selectedAnswer`: ユーザーの選択
- `isAnswered`: 回答済みフラグ
- `session`: セッション情報（問題データ）
- ブックマーク状態（`useBookmarks` フック）

**ブックマーク機能** (要望③④):
- ブックマークボタンをクリックして問題を保存
- ローカルストレージに自動保存
- ブックマーク済みは色が変わる

---

### 4. 試験結果ページ (`/exam/results/page.tsx`)
**役割**: 試験終了後に成績を表示するページ

**機能**:
- ✅ **正解率をパーセンテージで表示**（要望⑥）
- ✅ 正解数/総問題数の表示
- ✅ 成績評価
  - 80%以上: 優秀
  - 60～79%: 合格
  - 40～59%: 要復習
  - 39%以下: 要徹底復習
- ✅ **問題ごとの結果を一覧表示**（要望⑥）
  - 各問題で、正解/不正解を表示
  - ユーザーの答えと正解を表示
- ✅ ブックマークページへのリンク
- ✅ 新しく問題を生成するボタン
- ✅ ホームページへのリンク
- ✅ 紙吹雪エフェクト

---

### 5. ブックマークページ (`/bookmarks/page.tsx`)
**役割**: ブックマークした問題を確認・復習するページ

**機能**:
- ✅ **ブックマークした問題を試験ごとにグループ化**
- ✅ 各試験のブックマーク数を表示
- ✅ 各問題を展開して詳細を表示
- ✅ 問題のステータス表示（正解/不正解）
- ✅ 選択肢と解説の表示
- ✅ ブックマーク削除機能
- ✅ 戻るボタン・ホームボタン
- ✅ 空の状態メッセージ

**状態管理**:
- `bookmarks`: ブックマーク一覧
- `expandedId`: 展開中の問題ID

---

## 🔗 カスタムフック

### `useBookmarks.ts`
**役割**: ローカルストレージを使用したブックマーク管理（要望④）

**機能**:
- ✅ ブックマークの追加
- ✅ ブックマークの削除
- ✅ ブックマークの確認
- ✅ ローカルストレージへの自動保存
- ✅ ローカルストレージからの読み込み

**返り値**:
```typescript
{
  bookmarks: BookmarkedQuestion[],
  addBookmark: (question) => void,
  removeBookmark: (examId, questionIndex) => void,
  isBookmarked: (examId, questionIndex) => boolean,
  isLoaded: boolean
}
```

---

## 📊 データフロー

### 1. 問題生成フロー
```
生成ページ → API呼び出し → Azure OpenAI → JSON解析 → セッションストレージ保存 → 問題ページリダイレクト
```

### 2. 回答フロー
```
問題ページで選択肢クリック → 正解判定 → 解説表示 → 次の問題へ移動
```

### 3. ブックマークフロー
```
問題ページでブックマークボタンクリック → useBookmarks.addBookmark() → ローカルストレージ保存 → ボタン色更新
```

### 4. ブックマーク確認フロー
```
ホーム → ブックマークページ → ブックマーク一覧表示 → 詳細表示・削除
```

---

## 🎨 デザイン特徴

- **グラデーション背景**: `from-blue-50 to-indigo-100`
- **カード型レイアウト**: 白背景、影、丸いボーダー
- **インタラクティブなボタン**: ホバー時のエフェクト
- **色分け表示**: 正解（緑）、不正解（赤）、ブックマーク（黄色）
- **進捗バー**: ビジュアルな進捗表示
- **レスポンシブデザイン**: モバイル対応

---

## 💾 ストレージ

### セッションストレージ
- `exam-session`: 現在の試験セッション情報
  ```json
  {
    "examType": "試験名",
    "questions": [...],
    "createdAt": "ISO日時"
  }
  ```

### ローカルストレージ
- `exam-bookmarks`: ブックマーク済み問題
  ```json
  [
    {
      "examId": "試験名",
      "questionIndex": 0,
      "question": "問題文",
      "options": [...],
      "answer": 0,
      "explanation": "解説",
      "userAnswer": 1,
      "isCorrect": false,
      "timestamp": 1234567890
    }
  ]
  ```

---

## 🚀 要望への対応マッピング

| 要望 | 対応内容 | 実装箇所 |
|------|--------|--------|
| ① 問題生成→1問ずつ表示 | 生成ページで設定 → 個別問題ページで表示 | `/generate`, `/exam/[id]` |
| ② 戻るボタン | 各ページに実装 | 全ページ |
| ③ ブックマーク・ホームボタン | 問題ページに実装 | `/exam/[id]` |
| ④ ブックマーク履歴保存 | ローカルストレージで永続化 | `useBookmarks`, `/bookmarks` |
| ⑤ メニュー（ホーム）→複数画面 | ホーム画面で2つの選択肢を提供 | `page.tsx`, `/generate`, `/bookmarks` |
| ⑥ 正解率表示・問題振り返り | 結果ページで詳細表示 | `/exam/results` |

---

## 🛠️ 使用技術

- **フレームワーク**: Next.js 16 (App Router)
- **言語**: TypeScript
- **UI**: Tailwind CSS + lucide-react
- **API**: Azure OpenAI
- **ストレージ**: localStorage, sessionStorage
- **エフェクト**: canvas-confetti

---

## 📝 今後の拡張案

- データベース連携でブックマークをサーバー保存
- ユーザー認証機能
- 学習統計・分析ダッシュボード
- 複数の問題セットの同時管理
- 友達とスコアを共有
- カスタム問題の手動作成機能
- 音声での問題読み上げ
